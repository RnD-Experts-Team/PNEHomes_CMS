import{e as s,j as l}from"./app-C3rsozrc.js";async function d(){window.google?.accounts?.oauth2||await new Promise((n,o)=>{const e=document.createElement("script");e.src="https://accounts.google.com/gsi/client",e.async=!0,e.defer=!0,e.onload=()=>{console.debug("[GIS] loaded"),n()},e.onerror=()=>o(new Error("[GIS] failed to load")),document.head.appendChild(e)})}async function p(){window.gapi?.picker||await new Promise((n,o)=>{const e=document.createElement("script");e.src="https://apis.google.com/js/api.js",e.async=!0,e.defer=!0,e.onload=()=>{console.debug("[GAPI] api.js loaded, loading picker..."),window.gapi.load("picker",{callback:()=>{console.debug("[GAPI] picker loaded"),n()},onerror:()=>o(new Error("[GAPI] picker failed to load"))})},e.onerror=()=>o(new Error("[GAPI] api.js failed to load")),document.head.appendChild(e)})}async function u(n){await Promise.all([d(),p()]);const o=window.google;if(!o?.accounts?.oauth2)throw new Error("GIS not available");if(!window.gapi?.picker)throw new Error("Picker not available");const e=await new Promise((c,i)=>{o.accounts.oauth2.initTokenClient({client_id:n.clientId,scope:"https://www.googleapis.com/auth/drive.readonly",callback:t=>t?.access_token?c(t.access_token):i(new Error("No access token")),error_callback:t=>i(t)}).requestAccessToken({prompt:""})});return new Promise(c=>{const i=new o.picker.DocsView(o.picker.ViewId.DOCS);new o.picker.PickerBuilder().setDeveloperKey(n.apiKey).setOAuthToken(e).setOrigin(`${window.location.protocol}//${window.location.host}`).setTitle("Select or Upload File").addView(i).setCallback(t=>{if(t?.action===o.picker.Action.PICKED){const r=t.docs?.[0];return c(r?{id:r.id,mimeType:r.mimeType,name:r.name}:null)}if(t?.action===o.picker.Action.CANCEL)return c(null)}).build().setVisible(!0)})}const k=({onPick:n,label:o="Pick"})=>{const{google:e}=s().props,c=async()=>{try{const i=await u({apiKey:e.apiKey,clientId:e.clientId});i?.id&&n(i.id)}catch(i){console.error(i),alert("Google Drive Picker failed to open. Check API key/client ID and OAuth consent screen.")}};return l.jsx("button",{type:"button",onClick:c,className:"inline-flex items-center rounded border px-2 py-1 text-sm",children:o})};export{k as I};
