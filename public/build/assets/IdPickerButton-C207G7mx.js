import{e as u,j as w}from"./app-C95Nb1Q_.js";async function m(){window.google?.accounts?.oauth2||await new Promise((t,i)=>{const e=document.createElement("script");e.src="https://accounts.google.com/gsi/client",e.async=!0,e.defer=!0,e.onload=()=>{console.debug("[GIS] loaded"),t()},e.onerror=()=>i(new Error("[GIS] failed to load")),document.head.appendChild(e)})}async function k(){window.gapi?.picker||await new Promise((t,i)=>{const e=document.createElement("script");e.src="https://apis.google.com/js/api.js",e.async=!0,e.defer=!0,e.onload=()=>{console.debug("[GAPI] api.js loaded, loading picker..."),window.gapi.load("picker",{callback:()=>{console.debug("[GAPI] picker loaded"),t()},onerror:()=>i(new Error("[GAPI] picker failed to load"))})},e.onerror=()=>i(new Error("[GAPI] api.js failed to load")),document.head.appendChild(e)})}async function d(t,i={}){await Promise.all([m(),k()]);const e=window.google;if(!e?.accounts?.oauth2)throw new Error("GIS not available");if(!window.gapi?.picker)throw new Error("Picker not available");const l=await new Promise((c,n)=>{e.accounts.oauth2.initTokenClient({client_id:t.clientId,scope:"https://www.googleapis.com/auth/drive.readonly",callback:o=>o?.access_token?c(o.access_token):n(new Error("No access token")),error_callback:o=>n(o)}).requestAccessToken({prompt:""})});return new Promise(c=>{const n=new e.picker.DocsView(e.picker.ViewId.DOCS);i.mimeTypes?.length&&n.setMimeTypes(i.mimeTypes.join(","));const r=new e.picker.PickerBuilder().setDeveloperKey(t.apiKey).setOAuthToken(l).setOrigin(`${window.location.protocol}//${window.location.host}`).setTitle(i.title??"Select files").addView(n);i.multiple&&r.enableFeature(e.picker.Feature.MULTISELECT_ENABLED),r.setCallback(a=>{if(a?.action===e.picker.Action.PICKED){const p=(a.docs??[]).map(s=>({id:s.id,mimeType:s.mimeType,name:s.name}));return c(p)}if(a?.action===e.picker.Action.CANCEL)return c([])}).build().setVisible(!0)})}async function f(t,i={}){return(await d(t,{...i,multiple:!1}))[0]??null}const h=({onPick:t,onPickMany:i,label:e="Pick",multiple:l=!1,mimeTypes:c})=>{const{google:n}=u().props,r=async()=>{try{if(l){const o=await d({apiKey:n.apiKey,clientId:n.clientId},{multiple:!0,mimeTypes:c,title:"Select images"});o.length&&i&&i(o.map(a=>a.id))}else{const o=await f({apiKey:n.apiKey,clientId:n.clientId},{mimeTypes:c,title:"Select file"});o?.id&&t&&t(o.id)}}catch(o){console.error(o),alert("Google Drive Picker failed to open. Check API key/client ID and OAuth consent screen.")}};return w.jsx("button",{type:"button",onClick:r,className:"inline-flex items-center rounded border px-2 py-1 text-sm",children:e})};export{h as I};
